[2025-11-21 10:45:59] local.INFO: Handling VisitCreated event for visit ID: 13  
[2025-11-21 10:45:59] local.INFO: Loaded visit: found  
[2025-11-21 10:45:59] local.INFO: Creating invoice for visit ID: 13  
[2025-11-21 10:45:59] local.INFO: Medication Line Items: []  
[2025-11-21 10:45:59] local.INFO: Service Line Items: []  
[2025-11-21 10:46:36] local.INFO: Creating visit with data: {"patient_id":3,"vet_id":1,"visit_date":"2025-11-21T10:46"}  
[2025-11-21 10:46:36] local.INFO: Handling VisitCreated event for visit ID: 14  
[2025-11-21 10:46:36] local.INFO: Loaded visit: found  
[2025-11-21 10:46:36] local.INFO: Creating invoice for visit ID: 14  
[2025-11-21 10:46:36] local.INFO: Medication Line Items: []  
[2025-11-21 10:46:36] local.INFO: Service Line Items: []  
[2025-11-21 10:47:19] local.INFO: Creating visit with data: {"patient_id":1,"vet_id":1,"visit_date":"2025-11-21T10:47","medication_ids":[2],"service_ids":[1]}  
[2025-11-21 10:47:19] local.INFO: Syncing medications with pivot data: {"2":{"quantity":1}}  
[2025-11-21 10:47:19] local.INFO: Syncing services with pivot data: {"1":{"quantity":1}}  
[2025-11-21 10:47:19] local.INFO: Handling VisitCreated event for visit ID: 15  
[2025-11-21 10:47:19] local.INFO: Loaded visit: found  
[2025-11-21 10:47:19] local.INFO: Creating invoice for visit ID: 15  
[2025-11-21 10:47:19] local.INFO: Medication Line Items: [{"description":"Prednisone","quantity":1,"price":"18.00"}]  
[2025-11-21 10:47:19] local.INFO: Service Line Items: [{"description":"Wellness Exam","quantity":1,"price":"45.00"}]  
[2025-11-21 10:47:19] local.ERROR: Undefined array key "unit_price" {"userId":1,"exception":"[object] (ErrorException(code: 0): Undefined array key \"unit_price\" at /home/jadoueik/code/vet-life-api/app/Domain/Invoicing/Services/InvoiceService.php:51)
[stacktrace]
#0 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Bootstrap/HandleExceptions.php(255): Illuminate\\Foundation\\Bootstrap\\HandleExceptions->handleError()
#1 /home/jadoueik/code/vet-life-api/app/Domain/Invoicing/Services/InvoiceService.php(51): Illuminate\\Foundation\\Bootstrap\\HandleExceptions->Illuminate\\Foundation\\Bootstrap\\{closure}()
#2 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Collections/Traits/EnumeratesValues.php(791): App\\Domain\\Invoicing\\Services\\InvoiceService->App\\Domain\\Invoicing\\Services\\{closure}()
#3 /home/jadoueik/code/vet-life-api/app/Domain/Invoicing/Services/InvoiceService.php(50): Illuminate\\Support\\Collection->reduce()
#4 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Database/Concerns/ManagesTransactions.php(30): App\\Domain\\Invoicing\\Services\\InvoiceService->App\\Domain\\Invoicing\\Services\\{closure}()
#5 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Database/DatabaseManager.php(509): Illuminate\\Database\\Connection->transaction()
#6 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Support/Facades/Facade.php(355): Illuminate\\Database\\DatabaseManager->__call()
#7 /home/jadoueik/code/vet-life-api/app/Domain/Invoicing/Services/InvoiceService.php(42): Illuminate\\Support\\Facades\\Facade::__callStatic()
#8 /home/jadoueik/code/vet-life-api/app/Domain/Visits/Listeners/CreateInvoiceForVisit.php(50): App\\Domain\\Invoicing\\Services\\InvoiceService->create()
#9 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Events/Dispatcher.php(478): App\\Domain\\Visits\\Listeners\\CreateInvoiceForVisit->handle()
#10 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Events/Dispatcher.php(286): Illuminate\\Events\\Dispatcher->Illuminate\\Events\\{closure}()
#11 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Events/Dispatcher.php(266): Illuminate\\Events\\Dispatcher->invokeListeners()
#12 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Support/Facades/Facade.php(355): Illuminate\\Events\\Dispatcher->dispatch()
#13 /home/jadoueik/code/vet-life-api/app/Domain/Visits/Services/VisitService.php(41): Illuminate\\Support\\Facades\\Facade::__callStatic()
#14 /home/jadoueik/code/vet-life-api/app/Domain/Visits/Http/Controllers/VisitController.php(34): App\\Domain\\Visits\\Services\\VisitService->create()
#15 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Controller.php(54): App\\Domain\\Visits\\Http\\Controllers\\VisitController->store()
#16 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/ControllerDispatcher.php(43): Illuminate\\Routing\\Controller->callAction()
#17 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Route.php(259): Illuminate\\Routing\\ControllerDispatcher->dispatch()
#18 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Route.php(205): Illuminate\\Routing\\Route->runController()
#19 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Router.php(806): Illuminate\\Routing\\Route->run()
#20 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(144): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}()
#21 /home/jadoueik/code/vet-life-api/app/Http/Middleware/EnsureFeatureEnabled.php(18): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#22 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): App\\Http\\Middleware\\EnsureFeatureEnabled->handle()
#23 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Middleware/SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#24 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle()
#25 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Auth/Middleware/Authenticate.php(57): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#26 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Auth\\Middleware\\Authenticate->handle()
#27 /home/jadoueik/code/vet-life-api/vendor/laravel/sanctum/src/Http/Middleware/EnsureFrontendRequestsAreStateful.php(25): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#28 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(144): Laravel\\Sanctum\\Http\\Middleware\\EnsureFrontendRequestsAreStateful->Laravel\\Sanctum\\Http\\Middleware\\{closure}()
#29 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(119): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#30 /home/jadoueik/code/vet-life-api/vendor/laravel/sanctum/src/Http/Middleware/EnsureFrontendRequestsAreStateful.php(24): Illuminate\\Pipeline\\Pipeline->then()
#31 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Laravel\\Sanctum\\Http\\Middleware\\EnsureFrontendRequestsAreStateful->handle()
#32 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(119): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#33 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Router.php(805): Illuminate\\Pipeline\\Pipeline->then()
#34 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Router.php(784): Illuminate\\Routing\\Router->runRouteWithinStack()
#35 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Router.php(748): Illuminate\\Routing\\Router->runRoute()
#36 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Router.php(737): Illuminate\\Routing\\Router->dispatchToRoute()
#37 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(200): Illuminate\\Routing\\Router->dispatch()
#38 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(144): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}()
#39 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Http/Middleware/HandleCors.php(62): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#40 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Http\\Middleware\\HandleCors->handle()
#41 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#42 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle()
#43 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle()
#44 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#45 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle()
#46 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle()
#47 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#48 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle()
#49 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/PreventRequestsDuringMaintenance.php(99): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#50 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle()
#51 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(119): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#52 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(175): Illuminate\\Pipeline\\Pipeline->then()
#53 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(144): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter()
#54 /home/jadoueik/code/vet-life-api/public/index.php(13): Illuminate\\Foundation\\Http\\Kernel->handle()
#55 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/resources/server.php(16): require_once('...')
#56 {main}
"} 
[2025-11-21 10:48:05] local.INFO: Creating visit with data: {"patient_id":1,"vet_id":1,"visit_date":"2025-11-21T10:47","medication_ids":[2],"service_ids":[1]}  
[2025-11-21 10:48:05] local.INFO: Syncing medications with pivot data: {"2":{"quantity":1}}  
[2025-11-21 10:48:05] local.INFO: Syncing services with pivot data: {"1":{"quantity":1}}  
[2025-11-21 10:48:05] local.INFO: Handling VisitCreated event for visit ID: 16  
[2025-11-21 10:48:05] local.INFO: Loaded visit: found  
[2025-11-21 10:48:05] local.INFO: Creating invoice for visit ID: 16  
[2025-11-21 10:48:05] local.INFO: Medication Line Items: [{"description":"Prednisone","quantity":1,"price":"18.00"}]  
[2025-11-21 10:48:05] local.INFO: Service Line Items: [{"description":"Wellness Exam","quantity":1,"price":"45.00"}]  
[2025-11-21 10:48:05] local.ERROR: Undefined array key "unit_price" {"userId":1,"exception":"[object] (ErrorException(code: 0): Undefined array key \"unit_price\" at /home/jadoueik/code/vet-life-api/app/Domain/Invoicing/Services/InvoiceService.php:51)
[stacktrace]
#0 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Bootstrap/HandleExceptions.php(255): Illuminate\\Foundation\\Bootstrap\\HandleExceptions->handleError()
#1 /home/jadoueik/code/vet-life-api/app/Domain/Invoicing/Services/InvoiceService.php(51): Illuminate\\Foundation\\Bootstrap\\HandleExceptions->Illuminate\\Foundation\\Bootstrap\\{closure}()
#2 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Collections/Traits/EnumeratesValues.php(791): App\\Domain\\Invoicing\\Services\\InvoiceService->App\\Domain\\Invoicing\\Services\\{closure}()
#3 /home/jadoueik/code/vet-life-api/app/Domain/Invoicing/Services/InvoiceService.php(50): Illuminate\\Support\\Collection->reduce()
#4 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Database/Concerns/ManagesTransactions.php(30): App\\Domain\\Invoicing\\Services\\InvoiceService->App\\Domain\\Invoicing\\Services\\{closure}()
#5 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Database/DatabaseManager.php(509): Illuminate\\Database\\Connection->transaction()
#6 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Support/Facades/Facade.php(355): Illuminate\\Database\\DatabaseManager->__call()
#7 /home/jadoueik/code/vet-life-api/app/Domain/Invoicing/Services/InvoiceService.php(42): Illuminate\\Support\\Facades\\Facade::__callStatic()
#8 /home/jadoueik/code/vet-life-api/app/Domain/Visits/Listeners/CreateInvoiceForVisit.php(50): App\\Domain\\Invoicing\\Services\\InvoiceService->create()
#9 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Events/Dispatcher.php(478): App\\Domain\\Visits\\Listeners\\CreateInvoiceForVisit->handle()
#10 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Events/Dispatcher.php(286): Illuminate\\Events\\Dispatcher->Illuminate\\Events\\{closure}()
#11 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Events/Dispatcher.php(266): Illuminate\\Events\\Dispatcher->invokeListeners()
#12 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Support/Facades/Facade.php(355): Illuminate\\Events\\Dispatcher->dispatch()
#13 /home/jadoueik/code/vet-life-api/app/Domain/Visits/Services/VisitService.php(41): Illuminate\\Support\\Facades\\Facade::__callStatic()
#14 /home/jadoueik/code/vet-life-api/app/Domain/Visits/Http/Controllers/VisitController.php(34): App\\Domain\\Visits\\Services\\VisitService->create()
#15 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Controller.php(54): App\\Domain\\Visits\\Http\\Controllers\\VisitController->store()
#16 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/ControllerDispatcher.php(43): Illuminate\\Routing\\Controller->callAction()
#17 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Route.php(259): Illuminate\\Routing\\ControllerDispatcher->dispatch()
#18 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Route.php(205): Illuminate\\Routing\\Route->runController()
#19 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Router.php(806): Illuminate\\Routing\\Route->run()
#20 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(144): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}()
#21 /home/jadoueik/code/vet-life-api/app/Http/Middleware/EnsureFeatureEnabled.php(18): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#22 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): App\\Http\\Middleware\\EnsureFeatureEnabled->handle()
#23 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Middleware/SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#24 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle()
#25 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Auth/Middleware/Authenticate.php(57): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#26 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Auth\\Middleware\\Authenticate->handle()
#27 /home/jadoueik/code/vet-life-api/vendor/laravel/sanctum/src/Http/Middleware/EnsureFrontendRequestsAreStateful.php(25): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#28 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(144): Laravel\\Sanctum\\Http\\Middleware\\EnsureFrontendRequestsAreStateful->Laravel\\Sanctum\\Http\\Middleware\\{closure}()
#29 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(119): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#30 /home/jadoueik/code/vet-life-api/vendor/laravel/sanctum/src/Http/Middleware/EnsureFrontendRequestsAreStateful.php(24): Illuminate\\Pipeline\\Pipeline->then()
#31 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Laravel\\Sanctum\\Http\\Middleware\\EnsureFrontendRequestsAreStateful->handle()
#32 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(119): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#33 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Router.php(805): Illuminate\\Pipeline\\Pipeline->then()
#34 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Router.php(784): Illuminate\\Routing\\Router->runRouteWithinStack()
#35 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Router.php(748): Illuminate\\Routing\\Router->runRoute()
#36 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Router.php(737): Illuminate\\Routing\\Router->dispatchToRoute()
#37 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(200): Illuminate\\Routing\\Router->dispatch()
#38 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(144): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}()
#39 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Http/Middleware/HandleCors.php(62): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#40 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Http\\Middleware\\HandleCors->handle()
#41 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#42 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle()
#43 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle()
#44 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#45 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle()
#46 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle()
#47 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#48 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle()
#49 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/PreventRequestsDuringMaintenance.php(99): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#50 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle()
#51 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(119): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#52 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(175): Illuminate\\Pipeline\\Pipeline->then()
#53 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(144): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter()
#54 /home/jadoueik/code/vet-life-api/public/index.php(13): Illuminate\\Foundation\\Http\\Kernel->handle()
#55 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/resources/server.php(16): require_once('...')
#56 {main}
"} 
[2025-11-21 10:48:24] local.INFO: Creating visit with data: {"patient_id":1,"vet_id":1,"visit_date":"2025-11-21T10:47","medication_ids":[2],"service_ids":[1]}  
[2025-11-21 10:48:24] local.INFO: Syncing medications with pivot data: {"2":{"quantity":1}}  
[2025-11-21 10:48:24] local.INFO: Syncing services with pivot data: {"1":{"quantity":1}}  
[2025-11-21 10:48:24] local.INFO: Handling VisitCreated event for visit ID: 17  
[2025-11-21 10:48:24] local.INFO: Loaded visit: found  
[2025-11-21 10:48:24] local.INFO: Creating invoice for visit ID: 17  
[2025-11-21 10:48:24] local.INFO: Medication Line Items: [{"description":"Prednisone","quantity":1,"price":"18.00"}]  
[2025-11-21 10:48:24] local.INFO: Service Line Items: [{"description":"Wellness Exam","quantity":1,"price":"45.00"}]  
[2025-11-21 10:48:24] local.ERROR: Undefined array key "unit_price" {"userId":1,"exception":"[object] (ErrorException(code: 0): Undefined array key \"unit_price\" at /home/jadoueik/code/vet-life-api/app/Domain/Invoicing/Services/InvoiceService.php:65)
[stacktrace]
#0 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Bootstrap/HandleExceptions.php(255): Illuminate\\Foundation\\Bootstrap\\HandleExceptions->handleError()
#1 /home/jadoueik/code/vet-life-api/app/Domain/Invoicing/Services/InvoiceService.php(65): Illuminate\\Foundation\\Bootstrap\\HandleExceptions->Illuminate\\Foundation\\Bootstrap\\{closure}()
#2 [internal function]: App\\Domain\\Invoicing\\Services\\InvoiceService->App\\Domain\\Invoicing\\Services\\{closure}()
#3 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Collections/Arr.php(600): array_map()
#4 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Collections/Collection.php(778): Illuminate\\Support\\Arr::map()
#5 /home/jadoueik/code/vet-life-api/app/Domain/Invoicing/Services/InvoiceService.php(61): Illuminate\\Support\\Collection->map()
#6 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Database/Concerns/ManagesTransactions.php(30): App\\Domain\\Invoicing\\Services\\InvoiceService->App\\Domain\\Invoicing\\Services\\{closure}()
#7 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Database/DatabaseManager.php(509): Illuminate\\Database\\Connection->transaction()
#8 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Support/Facades/Facade.php(355): Illuminate\\Database\\DatabaseManager->__call()
#9 /home/jadoueik/code/vet-life-api/app/Domain/Invoicing/Services/InvoiceService.php(42): Illuminate\\Support\\Facades\\Facade::__callStatic()
#10 /home/jadoueik/code/vet-life-api/app/Domain/Visits/Listeners/CreateInvoiceForVisit.php(50): App\\Domain\\Invoicing\\Services\\InvoiceService->create()
#11 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Events/Dispatcher.php(478): App\\Domain\\Visits\\Listeners\\CreateInvoiceForVisit->handle()
#12 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Events/Dispatcher.php(286): Illuminate\\Events\\Dispatcher->Illuminate\\Events\\{closure}()
#13 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Events/Dispatcher.php(266): Illuminate\\Events\\Dispatcher->invokeListeners()
#14 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Support/Facades/Facade.php(355): Illuminate\\Events\\Dispatcher->dispatch()
#15 /home/jadoueik/code/vet-life-api/app/Domain/Visits/Services/VisitService.php(41): Illuminate\\Support\\Facades\\Facade::__callStatic()
#16 /home/jadoueik/code/vet-life-api/app/Domain/Visits/Http/Controllers/VisitController.php(34): App\\Domain\\Visits\\Services\\VisitService->create()
#17 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Controller.php(54): App\\Domain\\Visits\\Http\\Controllers\\VisitController->store()
#18 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/ControllerDispatcher.php(43): Illuminate\\Routing\\Controller->callAction()
#19 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Route.php(259): Illuminate\\Routing\\ControllerDispatcher->dispatch()
#20 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Route.php(205): Illuminate\\Routing\\Route->runController()
#21 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Router.php(806): Illuminate\\Routing\\Route->run()
#22 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(144): Illuminate\\Routing\\Router->Illuminate\\Routing\\{closure}()
#23 /home/jadoueik/code/vet-life-api/app/Http/Middleware/EnsureFeatureEnabled.php(18): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#24 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): App\\Http\\Middleware\\EnsureFeatureEnabled->handle()
#25 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Middleware/SubstituteBindings.php(50): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#26 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Routing\\Middleware\\SubstituteBindings->handle()
#27 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Auth/Middleware/Authenticate.php(57): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#28 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Auth\\Middleware\\Authenticate->handle()
#29 /home/jadoueik/code/vet-life-api/vendor/laravel/sanctum/src/Http/Middleware/EnsureFrontendRequestsAreStateful.php(25): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#30 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(144): Laravel\\Sanctum\\Http\\Middleware\\EnsureFrontendRequestsAreStateful->Laravel\\Sanctum\\Http\\Middleware\\{closure}()
#31 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(119): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#32 /home/jadoueik/code/vet-life-api/vendor/laravel/sanctum/src/Http/Middleware/EnsureFrontendRequestsAreStateful.php(24): Illuminate\\Pipeline\\Pipeline->then()
#33 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Laravel\\Sanctum\\Http\\Middleware\\EnsureFrontendRequestsAreStateful->handle()
#34 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(119): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#35 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Router.php(805): Illuminate\\Pipeline\\Pipeline->then()
#36 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Router.php(784): Illuminate\\Routing\\Router->runRouteWithinStack()
#37 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Router.php(748): Illuminate\\Routing\\Router->runRoute()
#38 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Routing/Router.php(737): Illuminate\\Routing\\Router->dispatchToRoute()
#39 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(200): Illuminate\\Routing\\Router->dispatch()
#40 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(144): Illuminate\\Foundation\\Http\\Kernel->Illuminate\\Foundation\\Http\\{closure}()
#41 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Http/Middleware/HandleCors.php(62): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#42 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Http\\Middleware\\HandleCors->handle()
#43 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#44 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/ConvertEmptyStringsToNull.php(31): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle()
#45 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Foundation\\Http\\Middleware\\ConvertEmptyStringsToNull->handle()
#46 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TransformsRequest.php(21): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#47 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TrimStrings.php(40): Illuminate\\Foundation\\Http\\Middleware\\TransformsRequest->handle()
#48 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Foundation\\Http\\Middleware\\TrimStrings->handle()
#49 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/ValidatePostSize.php(27): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#50 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Foundation\\Http\\Middleware\\ValidatePostSize->handle()
#51 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/PreventRequestsDuringMaintenance.php(99): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#52 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(183): Illuminate\\Foundation\\Http\\Middleware\\PreventRequestsDuringMaintenance->handle()
#53 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(119): Illuminate\\Pipeline\\Pipeline->Illuminate\\Pipeline\\{closure}()
#54 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(175): Illuminate\\Pipeline\\Pipeline->then()
#55 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(144): Illuminate\\Foundation\\Http\\Kernel->sendRequestThroughRouter()
#56 /home/jadoueik/code/vet-life-api/public/index.php(13): Illuminate\\Foundation\\Http\\Kernel->handle()
#57 /home/jadoueik/code/vet-life-api/vendor/laravel/framework/src/Illuminate/Foundation/resources/server.php(16): require_once('...')
#58 {main}
"} 
[2025-11-21 10:48:36] local.INFO: Creating visit with data: {"patient_id":1,"vet_id":1,"visit_date":"2025-11-21T10:47","medication_ids":[2],"service_ids":[1]}  
[2025-11-21 10:48:36] local.INFO: Syncing medications with pivot data: {"2":{"quantity":1}}  
[2025-11-21 10:48:36] local.INFO: Syncing services with pivot data: {"1":{"quantity":1}}  
[2025-11-21 10:48:36] local.INFO: Handling VisitCreated event for visit ID: 18  
[2025-11-21 10:48:36] local.INFO: Loaded visit: found  
[2025-11-21 10:48:36] local.INFO: Creating invoice for visit ID: 18  
[2025-11-21 10:48:36] local.INFO: Medication Line Items: [{"description":"Prednisone","quantity":1,"price":"18.00"}]  
[2025-11-21 10:48:36] local.INFO: Service Line Items: [{"description":"Wellness Exam","quantity":1,"price":"45.00"}]  
